---
# =============================================================================
# Configuration de Base - Infrastructure Dev
# =============================================================================
# Ce fichier contient les paramètres communs partagés entre tous les environnements
# et le sélecteur d'environnement actif.
#
# Chaque application a ses propres fichiers de configuration :
#   metallb/config-dev.yaml, metallb/config-prod.yaml
#   cert-manager/config-dev.yaml, cert-manager/config-prod.yaml
#   etc.
#
# Pour basculer d'environnement, changer la valeur ci-dessous :
#   environment: dev  → pour développement
#   environment: prod → pour production
#
# Le Merge Generator fusionnera automatiquement ce fichier avec
# le fichier config-{environment}.yaml de chaque application.
# =============================================================================

# Environnement actif (dev ou prod)
environment: dev

# Politique de synchronisation (base, peut être override par environnement)
syncPolicy:
  automated:
    enabled: false  # Désactivé par défaut (prod = sync manuel)
  retry:
    limit: 5        # Augmenté de 3 à 5
    backoff:
      duration: 5s
      factor: 2
      maxDuration: 5m  # Augmenté de 3m à 5m
  syncOptions:
    - CreateNamespace=true
    - ServerSideApply=true
    - PruneLast=true
    - SkipDryRunOnMissingResource=true

# Paramètres communs partagés
common:
  domain: "gigix"
  certEmail: "admin@example.com"
  clusterIssuer: "selfsigned-cluster-issuer"

# Configuration Git
git:
  revision: "HEAD"  # Branche Git utilisée pour les ApplicationSets

# Versions des charts Helm
versions:
  argocd: "9.0.5"
  certManager: "v1.19.1"
  csiSnapshotter: "v8.4.0"
  externalDns: "1.19.0"
  external-dns-coredns: "1.45.0"  # CoreDNS chart for external-dns (coredns provider)
  external-dns-etcd: "1.1.3"      # etcd chart for external-dns (coredns backend)
  gatewayApiController: "v1.4.0"
  ingressNginx: "4.13.3"
  longhorn: "1.10.0"
  metallb: "0.15.2"
  nginxGatewayFabric: "v1.5.1"
  prometheusStack: "79.0.0"

# Feature flags - Activation des composants
features:
  metallb:
    enabled: true

  certManager:
    enabled: true
    issuerType: "letsencrypt-staging"

  externalDns:
    enabled: true
    # provider: "coredns"  # ou: aws, google, azure, etc.

  ingress:
    enabled: true
    class: "nginx"

  storage:
    enabled: true
    class: "longhorn"
    csiSnapshotter: true  # CSI External Snapshotter (requis pour Longhorn)

  monitoring:
    enabled: true
    prometheus: true
    grafana: true
    release: "prometheus-stack"  # Release name for ServiceMonitor discovery
    dashboard:
      label: "1"  # Label value for grafana_dashboard (enables auto-import)
      baseFolder: "/tmp/dashboards"  # Base folder for dashboard organization
      folderAnnotation: "grafana_dashboard_folder"  # Annotation name for dashboard folder path
