---
# =============================================================================
# Configuration de Base - Infrastructure Dev
# =============================================================================
# Ce fichier contient les paramètres communs partagés entre tous les environnements
# et le sélecteur d'environnement actif.
#
# Chaque application a ses propres fichiers de configuration :
#   metallb/config-dev.yaml, metallb/config-prod.yaml
#   cert-manager/config-dev.yaml, cert-manager/config-prod.yaml
#   etc.
#
# Pour basculer d'environnement, changer la valeur ci-dessous :
#   environment: dev  → pour développement
#   environment: prod → pour production
#
# Le Merge Generator fusionnera automatiquement ce fichier avec
# le fichier config-{environment}.yaml de chaque application.
# =============================================================================

# Environnement actif (dev ou prod)
environment: dev

# Politique de synchronisation (base, peut être override par environnement)
syncPolicy:
  automated:
    enabled: false
  retry:
    limit: 5
    backoff:
      duration: 5s
      factor: 2
      maxDuration: 5m
  syncOptions:
    - CreateNamespace=true
    - ServerSideApply=true
    - PruneLast=true
    - SkipDryRunOnMissingResource=true
    - RespectIgnoreDifferences=true

# Paramètres communs partagés
common:
  domain: "k8s.lan"
  certEmail: "admin@example.com"
  clusterIssuer: "selfsigned-cluster-issuer"

# Configuration Git
git:
  revision: "HEAD"

# Versions des charts Helm
versions:
  argocd: "9.1.3"
  certManager: "v1.19.1"
  cnpgOperator: "0.26.1"
  csiSnapshotter: "v8.4.0"
  envoyGateway: "v1.6.0"
  externalDns: "1.19.0"
  externalSecrets: "1.1.0"
  external-dns-coredns: "1.45.0"
  external-dns-etcd: "1.1.4"
  gatewayApiController: "v1.4.0"
  ingressNginx: "4.14.0"
  keycloakOperator: "26.4.6"
  longhorn: "1.10.1"
  metallb: "0.15.2"
  nginxGatewayFabric: "v1.5.1"
  prometheusStack: "79.5.0"
  traefik: "37.4.0"
  oauth2Proxy: "9.0.0"

# Feature flags - Activation des composants
features:
  metallb:
    enabled: true

  certManager:
    enabled: true
    issuerType: "letsencrypt-staging"
    # issuerType: "letsencrypt-prod"

  externalDns:
    enabled: true
    # provider: "coredns"  # ou: aws, google, azure, etc.

  ingress:
    enabled: false  # Disabled - using Gateway API HTTPRoute instead
    class: "istio"  # Used by deploy-applicationsets.sh to patch Ingress resources if needed
                    # For Istio, we use Gateway API, but some legacy charts might still create Ingress

  gatewayAPI:
    httpRoute:
      enabled: true  # Enable HTTPRoute resources (Gateway API)

  storage:
    enabled: true
    class: "longhorn"
    csiSnapshotter: true  # CSI External Snapshotter (requis pour Longhorn)

  monitoring:
    enabled: true
    prometheus: true
    grafana: true
    release: "prometheus-stack"  # Release name for ServiceMonitor discovery
    dashboard:
      label: "1"  # Label value for grafana_dashboard (enables auto-import)
      baseFolder: "/tmp/dashboards"  # Base folder for dashboard organization
      folderAnnotation: "grafana_dashboard_folder"  # Annotation name for dashboard folder path

  # SSO (Single Sign-On) - Keycloak + OAuth2-Proxy
  # When disabled:
  #   - Keycloak and OAuth2-Proxy are NOT deployed
  #   - ArgoCD uses local admin authentication
  #   - Grafana uses local admin (admin/password from secrets)
  #   - Kiali uses anonymous authentication
  #   - Prometheus/Alertmanager/Hubble/Longhorn are accessible without auth
  sso:
    enabled: true
