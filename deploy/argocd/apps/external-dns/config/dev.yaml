---
# Configuration External-DNS - Dev
environment: dev
appName: external-dns

externalDns:
  version: "1.20.0"
  # Provider: cloudflare, aws, google, coredns, etc.
  # Use "coredns" for local DNS with etcd backend
  provider: "coredns"

  # TXT owner ID
  txtOwnerId: "external-dns-dev"

  # Sources to watch (service, ingress, crd, gateway-httproute, istio-gateway, etc.)
  # Note: istio-gateway requires Istio Gateway CRD to be installed
  sources:
    - "service"
    - "ingress"
    - "crd"
    - "gateway-httproute"  # Gateway API HTTPRoute support

  # Sync interval
  interval: "30s"

  # Policy: sync or upsert-only
  policy: "sync"

  # RBAC
  rbac:
    create: true

  # CRD support
  crd:
    create: true

  # External-DNS resources (usage: 1m/20Mi)
  resources:
    requests:
      cpu: "10m"
      memory: "32Mi"
    limits:
      cpu: "200m"
      memory: "128Mi"

  # Wait-for-etcd init container resources
  waitForEtcd:
    resources:
      requests:
        cpu: "5m"
        memory: "32Mi"
      limits:
        cpu: "50m"
        memory: "64Mi"

  # CoreDNS configuration (only when provider=coredns)
  coredns:
    version: "1.45.0"
    enabled: true
    replicas: 1
    serviceType: "LoadBalancer"
    # loadBalancerIP is now centralized in config.yaml (features.externalDns.loadBalancerIP)
    # CoreDNS resources (usage: 5m/15Mi)
    resources:
      requests:
        cpu: "10m"
        memory: "24Mi"
      limits:
        cpu: "200m"
        memory: "128Mi"

  # etcd configuration (only when provider=coredns)
  etcd:
    version: "0.5.1"
    enabled: true
    replicas: 1
    # mTLS configuration (authentication via client certificates)
    tls:
      enabled: true
      serverSecret: "external-dns-etcd-server-tls"
      clientSecret: "external-dns-etcd-client-tls"
      peerSecret: "external-dns-etcd-peer-tls"
      caSecret: "external-dns-etcd-ca"
    # etcd resources (usage: 6m/11Mi)
    resources:
      requests:
        cpu: "10m"
        memory: "16Mi"
      limits:
        cpu: "200m"
        memory: "128Mi"

syncPolicy:
  automated:
    enabled: true
    prune: true
    selfHeal: true
