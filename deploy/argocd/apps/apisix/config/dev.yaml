---
environment: dev
appName: apisix

apisix:
  namespace: apisix
  chart:
    repo: https://charts.apiseven.com
    name: apisix
    version: "2.12.5"

  # Replica count for dev environment
  replicaCount: 1

  # APISIX Configuration
  gateway:
    type: LoadBalancer
    # loadBalancerIP is now defined in global config: features.gatewayAPI.controller.loadBalancerIP
    http:
      enabled: true
    tls:
      enabled: true

  admin:
    enabled: true
    type: ClusterIP
    credentials:
      admin: edd1c9f034335f136f87ad84b625c8f1  # Default admin key (change in production)
      viewer: 4054f7cf07e344346cd3f287985e76a2  # Default viewer key

  # Enable Prometheus metrics
  serviceMonitor:
    enabled: true
    interval: 30s

  # Resource limits for dev
  resources:
    limits:
      cpu: "1000m"
      memory: "512Mi"
    requests:
      cpu: "100m"
      memory: "128Mi"

  # Stream proxy (Layer 4 - TCP/UDP) for TCPRoute/UDPRoute Gateway API
  stream_proxy:
    enabled: true
    tcp:
      - 9100
    udp:
      - 9200

  # ETCD configuration (embedded for dev)
  etcd:
    enabled: true
    replicaCount: 1
    persistence:
      enabled: true
      size: "2Gi"

# Gateway API resources (GatewayClass, Gateway, Certificate)
gatewayAPI:
  enabled: true  # Deploy GatewayClass and default-gateway

# APISIX Dashboard configuration
# Note: Using embedded dashboard (Admin API /ui/) instead of standalone chart
dashboard:
  enabled: false  # Standalone chart disabled - using embedded dashboard
  chart:
    repo: https://charts.apiseven.com
    name: apisix-dashboard
    version: "0.8.3"
  replicaCount: 1
  service:
    type: ClusterIP
    port: 80
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "500m"
      memory: "256Mi"
  config:
    listen:
      host: "0.0.0.0"
      port: 9000

# Embedded Dashboard (Admin API /ui/) - OIDC protected via ApisixRoute
embeddedDashboard:
  enabled: true

# APISIX Ingress Controller (sub-chart, for Gateway API support)
# Manages Gateway API CRDs and processes Gateway/HTTPRoute resources
ingressController:
  enabled: true
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "500m"
      memory: "256Mi"

# Sync policy
syncPolicy:
  automated:
    enabled: true
    prune: true
    selfHeal: true
  syncOptions:
    - CreateNamespace=true
    - RespectIgnoreDifferences=true
  retry:
    limit: 10
    backoff:
      duration: "10s"
      factor: 2
      maxDuration: "10m"
