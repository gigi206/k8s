---
environment: prod
appName: apisix

apisix:
  namespace: apisix
  chart:
    repo: https://charts.apiseven.com
    name: apisix
    version: "2.13.0"

  # APISIX Configuration
  gateway:
    type: LoadBalancer
    http:
      enabled: true
    tls:
      enabled: true

  admin:
    enabled: true
    type: ClusterIP
    credentials:
      admin: CHANGE_ME_IN_PRODUCTION
      viewer: CHANGE_ME_IN_PRODUCTION

  # Enable Prometheus metrics
  serviceMonitor:
    enabled: true
    interval: 30s

  # Resource limits for production
  replicaCount: 3
  resources:
    limits:
      cpu: "2000m"
      memory: "2Gi"
    requests:
      cpu: "500m"
      memory: "512Mi"

  # Stream proxy (Layer 4 - TCP/UDP) for TCPRoute/UDPRoute Gateway API
  stream_proxy:
    enabled: true
    tcp:
      - 9100
    udp:
      - 9200

  # ETCD configuration - External etcd (CloudPirates OCI chart)
  etcd:
    # Disable embedded Bitnami etcd (deprecated)
    builtin:
      enabled: false
    # External etcd (CloudPirates - quay.io/coreos/etcd)
    external:
      enabled: true
      host: "https://apisix-etcd:2379"  # HTTPS for mTLS
      replicas: 3  # HA setup
      version: "0.5.1"
      # mTLS configuration (authentication via client certificates)
      tls:
        enabled: true
        serverSecret: "apisix-etcd-server-tls"
        clientSecret: "apisix-etcd-client-tls"
        peerSecret: "apisix-etcd-peer-tls"
        caSecret: "apisix-etcd-ca"
      # Persistence disabled - GitOps re-syncs from CRDs
      persistence:
        enabled: false
        size: "1Gi"

# Gateway API resources (GatewayClass, Gateway, Certificate)
gatewayAPI:
  enabled: true  # Deploy GatewayClass and default-gateway

# APISIX Dashboard configuration
dashboard:
  enabled: true
  chart:
    repo: https://charts.apiseven.com
    name: apisix-dashboard
    version: "0.8.3"
  replicaCount: 2
  service:
    type: ClusterIP
    port: 80
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "1000m"
      memory: "512Mi"
  config:
    listen:
      host: "0.0.0.0"
      port: 9000

# APISIX Ingress Controller (sub-chart, for Gateway API support)
ingressController:
  enabled: true
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "1000m"
      memory: "512Mi"

# Sync policy (manual for production)
syncPolicy:
  automated:
    enabled: false
  syncOptions:
    - CreateNamespace=true
    - ServerSideApply=true
  retry:
    limit: 10
    backoff:
      duration: "10s"
      factor: 2
      maxDuration: "10m"
