---
# Configuration Traefik - Dev
environment: dev
appName: traefik

# Dashboard configuration
dashboard:
  folder: "Traefik"  # Sous-dossier pour les dashboards Traefik

traefik:
  version: "39.0.0"
  deployment:
    # Kind: Deployment or DaemonSet
    kind: "Deployment"
    # Replicas (dev: 1)
    replicas: 1

  # Service configuration
  service:
    type: "LoadBalancer"

  # IngressClass configuration
  ingressClass:
    enabled: true
    isDefaultClass: false  # nginx-ingress or istio is default

  # Gateway API - GatewayClass
  gatewayClass:
    enabled: true
    name: "traefik"

  # Resources (dev: minimal)
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "300m"
      memory: "256Mi"

  # Entrypoints
  ports:
    web:
      port: 8000
      exposedPort: 80
    websecure:
      port: 8443
      exposedPort: 443

  # Dashboard (dev: enabled for debugging)
  dashboard:
    enabled: true
    # Expose dashboard via HTTPRoute (traefik.k8s.lan)
    expose: true

  # Logs (dev: more verbose)
  logs:
    level: "INFO"
    accessLogs: true

  # High availability (dev: disabled - single replica)
  ha:
    hpa:
      enabled: false
    pdb:
      enabled: false

  # Security middlewares (dev: enabled for testing)
  security:
    enabled: true

syncPolicy:
  automated:
    enabled: true
    prune: true
    selfHeal: true
  # ServerSideApply=true allows shared CRD management
  # Traefik installs and manages Gateway API CRDs (standard channel)
  # SkipDryRunOnMissingResource=true: critical for multi-source apps - without it,
  # a missing CRD (e.g. Certificate before cert-manager syncs) aborts the ENTIRE
  # sync including CRD creation from the Helm chart, causing cascading delays.
  # RespectIgnoreDifferences=true: required because traefik defines ignoreDifferences
  # for HTTPRoute default fields added by the Gateway controller.
  syncOptions:
    - CreateNamespace=true
    - ServerSideApply=true
    - PruneLast=true
    - SkipDryRunOnMissingResource=true
    - RespectIgnoreDifferences=true
