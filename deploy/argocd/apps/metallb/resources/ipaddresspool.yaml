---
# =============================================================================
# MetalLB IPAddressPool & L2Advertisement
# =============================================================================
# Configure le pool d'adresses IP pour les services de type LoadBalancer
# Docs: https://metallb.universe.tf/configuration/
# =============================================================================

apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: default-pool
  namespace: metallb-system
spec:
  addresses:
    # Pool d'IPs disponibles pour les LoadBalancer
    # À adapter selon votre réseau
    - 192.168.121.240-192.168.121.250

---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: external-dns
  namespace: metallb-system
spec:
  addresses:
    # Pool dédié pour external-dns CoreDNS (réservé, auto-assign désactivé)
    - 192.168.121.201/32
  autoAssign: false  # Seuls les Services avec loadBalancerIP explicite peuvent utiliser ce pool

---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: kubernetes-api
  namespace: metallb-system
spec:
  addresses:
    # Pool dédié pour l'API Kubernetes (réservé, auto-assign désactivé)
    - 192.168.121.200/32
  autoAssign: false  # Seuls les Services avec loadBalancerIP explicite peuvent utiliser ce pool

---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: apisix-gateway
  namespace: metallb-system
spec:
  addresses:
    # Pool dédié pour APISIX Gateway (réservé, auto-assign désactivé)
    - 192.168.121.210/32
  autoAssign: false  # Seuls les Services avec loadBalancerIP explicite peuvent utiliser ce pool

---
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: default-advertisement
  namespace: metallb-system
spec:
  ipAddressPools:
    - default-pool
    - external-dns
    - kubernetes-api
    - apisix-gateway
