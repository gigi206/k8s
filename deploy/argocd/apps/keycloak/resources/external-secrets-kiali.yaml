---
# =============================================================================
# ExternalSecret - Kiali OIDC client secret sync (Istio only)
# =============================================================================
# Synchronise le secret OIDC de Kiali depuis istio-system vers keycloak
# CONDITIONNEL: Déployé uniquement si features.serviceMesh.enabled == true
# =============================================================================

apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: kiali-oidc-client-sync
  namespace: keycloak
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: istio-system-oidc-secrets
  target:
    name: kiali-oidc-client-secret
    creationPolicy: Owner
  data:
    - secretKey: client-secret
      remoteRef:
        key: kiali-oidc-client-secret
        property: client-secret
