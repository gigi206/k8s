---
# Configuration Prometheus-Stack - Prod
environment: prod
appName: prometheus-stack

prometheusStack:
  version: "80.14.4"
  prometheus:
    # Persistence (requires features.storage.enabled)
    persistence:
      enabled: true
      size: "5Gi"

    # Retention
    retention: "7d"

    # Replicas (prod: 2 for HA)
    replicas: 2

    # Resources (prod: higher limits)
    resources:
      requests:
        cpu: "500m"
        memory: "2Gi"
      limits:
        cpu: "2000m"
        memory: "4Gi"

    # Ingress (prod: enabled)
    ingress:
      enabled: true
      hostname: "prometheus.{{ .common.domain }}"

    # Remote write receiver (for external metrics)
    enableRemoteWriteReceiver: false

  grafana:
    # Admin credentials managed via KSOPS encrypted secrets
    # See: secrets/secret-prod.yaml

    # Replicas (prod: 2 for HA)
    replicas: 2

    # Persistence (requires features.storage.enabled)
    persistence:
      enabled: true
      size: "10Gi"

    # Resources (prod: higher limits)
    resources:
      requests:
        cpu: "200m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"

    # Ingress (prod: enabled)
    ingress:
      enabled: true
      hostname: "grafana.{{ .common.domain }}"

    # Grafana.ini configuration
    grafanaIni:
      analytics:
        check_for_updates: false

      # Alerting configuration
      unified_alerting:
        enabled: true      # Nouveau système d'alerting (Grafana 8+, obligatoire depuis Grafana 12+)

    # Sidecar dashboards configuration
    # Note: folderAnnotation est géré par ApplicationSet via features.monitoring.dashboard.folderAnnotation
    sidecar:
      dashboards:
        enabled: true
        # folderAnnotation: géré par ApplicationSet (default: features.monitoring.dashboard.folderAnnotation)
        folder: "Prometheus Stack"  # Nom du dossier Grafana pour les dashboards
        provider:
          foldersFromFilesStructure: true

    # Readiness probe
    readinessProbe:
      timeoutSeconds: 5

  alertmanager:
    # Alertmanager (prod: enabled)
    enabled: true
    replicas: 3

    # Persistence (requires features.storage.enabled)
    persistence:
      enabled: true
      size: "5Gi"

    # Ingress (prod: enabled)
    ingress:
      enabled: true
      hostname: "alertmanager.{{ .common.domain }}"

  pushgateway:
    # Pushgateway (prod: disabled)
    enabled: false

    # Resources (prod: higher limits)
    resources:
      requests:
        cpu: "200m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "512Mi"

    # ServiceMonitor
    serviceMonitor:
      enabled: true
      namespace: "monitoring"

syncPolicy:
  automated:
    enabled: false  # Prod: manual sync
    prune: true
    selfHeal: true
