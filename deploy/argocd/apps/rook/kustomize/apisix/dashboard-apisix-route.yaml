---
# =============================================================================
# ApisixUpstream - Ceph Dashboard HTTPS Backend
# =============================================================================
# Configures HTTPS scheme for the Ceph Dashboard backend.
# Must be in the same file as ApisixRoute to ensure correct ordering.
# =============================================================================
apiVersion: apisix.apache.org/v2
kind: ApisixUpstream
metadata:
  name: rook-ceph-mgr-dashboard
  namespace: rook-ceph
spec:
  scheme: https
---
# =============================================================================
# ApisixRoute - Ceph Dashboard
# =============================================================================
# Routes traffic to Ceph Dashboard (HTTPS backend on port 8443)
# Note: Ceph Dashboard uses SAML2 SSO directly with Keycloak for authentication
# =============================================================================
apiVersion: apisix.apache.org/v2
kind: ApisixRoute
metadata:
  name: ceph-dashboard
  namespace: rook-ceph
spec:
  ingressClassName: apisix
  http:
    - name: dashboard
      match:
        hosts:
          - ceph.PLACEHOLDER_DOMAIN  # Patched via Kustomize from common.domain
        paths:
          - /*
      backends:
        - serviceName: rook-ceph-mgr-dashboard
          servicePort: 8443
