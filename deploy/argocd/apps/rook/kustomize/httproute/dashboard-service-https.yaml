---
# =============================================================================
# Service - Ceph Dashboard with appProtocol: https
# =============================================================================
# Custom Service that exposes the Ceph Dashboard with appProtocol: https.
# This is needed because:
# - Rook operator doesn't set appProtocol on its dashboard Service
# - APISIX Ingress Controller uses appProtocol to determine upstream scheme
# - The original rook-ceph-mgr-dashboard Service is managed by Rook
#
# This Service uses the same selector as Rook's dashboard Service but adds
# appProtocol: https so APISIX knows to use HTTPS for backend connections.
# =============================================================================
apiVersion: v1
kind: Service
metadata:
  name: ceph-dashboard-https
  namespace: rook-ceph
  labels:
    app: rook-ceph-mgr
    rook_cluster: rook-ceph
  annotations:
    # Reference ServersTransport for Traefik to skip TLS verification on backend
    traefik.ingress.kubernetes.io/service.serverstransport: rook-ceph-ceph-dashboard-transport@kubernetescrd
spec:
  type: ClusterIP
  selector:
    app: rook-ceph-mgr
    mgr_role: active
    rook_cluster: rook-ceph
  ports:
    - name: https-dashboard
      port: 8443
      targetPort: 8443
      protocol: TCP
      appProtocol: https
