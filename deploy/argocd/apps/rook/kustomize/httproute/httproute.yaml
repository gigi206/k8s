---
# =============================================================================
# HTTPRoute - Ceph Dashboard
# =============================================================================
# Note: This HTTPRoute does NOT use OAuth2 Proxy protection.
# Ceph Dashboard uses SAML2 SSO directly with Keycloak for authentication,
# which provides proper role mapping for dashboard permissions.
#
# HTTPS Backend: Uses custom Service (ceph-dashboard-https) with appProtocol: https.
# APISIX Gateway API automatically detects HTTPS backend from appProtocol field.
# This is needed because Rook operator doesn't set appProtocol on its Service.
# =============================================================================
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: ceph-dashboard
  namespace: rook-ceph
  annotations:
    cert-manager.io/cluster-issuer: selfsigned-cluster-issuer
spec:
  parentRefs:
  - group: gateway.networking.k8s.io
    kind: Gateway
    name: default-gateway
    namespace: PLACEHOLDER_GATEWAY_NS  # Patched via Kustomize from gatewayAPI.controller.gatewayNamespace
    sectionName: https
  hostnames:
  - "ceph.PLACEHOLDER.example.com"  # Patched via Kustomize from common.domain
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /
    backendRefs:
    - group: ""
      kind: Service
      name: ceph-dashboard-https
      port: 8443
      weight: 1
