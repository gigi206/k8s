---
# Configuration Kubescape - Dev
environment: dev
appName: kubescape

kubescape:
  # Helm chart version (kubescape-operator)
  version: "1.30.2"

  # Cluster name for identification
  clusterName: "dev-cluster"

  # Capabilities - what features to enable
  capabilities:
    # Configuration scanning
    configurationScan: enable
    continuousScan: enable       # Continuous posture evaluation
    nodeScan: enable             # Node configuration scanning

    # Vulnerability scanning
    vulnerabilityScan: enable
    relevancy: enable            # Runtime relevancy analysis
    nodeSbomGeneration: enable   # SBOM generation on nodes

    # Runtime capabilities
    runtimeObservability: enable
    networkPolicyService: enable
    admissionController: enable
    seccompProfileService: enable

    # Disabled for dev (resource intensive)
    runtimeDetection: disable    # eBPF-based runtime threat detection
    malwareDetection: disable    # Malware scanning

    # Prometheus integration
    prometheusExporter: enable

  # Scanning schedules (cron format)
  scheduler:
    configScan: "0 8 * * *"      # Daily at 8 AM UTC
    vulnScan: "0 0 * * *"        # Daily at midnight UTC
    registryScan: "0 0 * * *"    # Daily at midnight

  # Namespace exclusions (comma-separated)
  excludeNamespaces: "kubescape,kube-system,kube-public,kube-node-lease"

  # Storage configuration
  persistence:
    storageClass: "-"            # Use default storage class
    backingStorageSize: "5Gi"
    kubevulnSize: "5Gi"

  # Component resources (right-sized from kubectl top)
  kubescape:
    # actual: 116m/97Mi
    resources:
      requests:
        cpu: "150m"
        memory: "128Mi"
      limits:
        cpu: "400m"
        memory: "512Mi"

  operator:
    # actual: 1m/18Mi
    resources:
      requests:
        cpu: "5m"
        memory: "24Mi"
      limits:
        cpu: "200m"
        memory: "256Mi"

  kubevuln:
    # actual: 1m/247Mi (idle, spikes during scans)
    resources:
      requests:
        cpu: "5m"
        memory: "300Mi"
      limits:
        cpu: "1000m"
        memory: "2Gi"

  storage:
    # actual: 15m/106Mi
    resources:
      requests:
        cpu: "20m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"

  nodeAgent:
    # actual: 33m/286Mi
    resources:
      requests:
        cpu: "50m"
        memory: "350Mi"
      limits:
        cpu: "300m"
        memory: "1Gi"

  # Prometheus exporter (actual: 1m/12Mi)
  prometheusExporter:
    resources:
      requests:
        cpu: "5m"
        memory: "16Mi"
      limits:
        cpu: "50m"
        memory: "64Mi"

  # ServiceMonitor configuration
  serviceMonitor:
    enabled: true
    interval: "200s"
    scrapeTimeout: "150s"

syncPolicy:
  automated:
    enabled: true
    prune: true
    selfHeal: true
