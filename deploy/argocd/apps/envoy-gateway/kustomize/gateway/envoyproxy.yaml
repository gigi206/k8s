---
# =============================================================================
# EnvoyProxy - Service configuration for LoadBalancer
# =============================================================================
# Configures how Envoy Gateway creates the proxy Service (LoadBalancer).
# Annotations and loadBalancerClass are patched via ApplicationSet based
# on the active LoadBalancer provider (metallb, loxilb, cilium, etc.).
# =============================================================================
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: EnvoyProxy
metadata:
  name: envoy-proxy-config
  namespace: envoy-gateway-system
  annotations:
    # Applied before Gateway (wave 0) so the controller sees the correct
    # loadBalancerClass before creating the LoadBalancer service.
    # loadBalancerClass is immutable â€” wrong order causes a stuck pending VIP.
    argocd.argoproj.io/sync-wave: "-1"
spec:
  logging:
    level:
      default: warn
  provider:
    type: Kubernetes
    kubernetes:
      envoyService:
        type: LoadBalancer
        externalTrafficPolicy: Local
