---
# =============================================================================
# Kyverno PolicyException for kube-vip-cloud-provider
# =============================================================================
# Allows kube-vip-cloud-provider to mount ServiceAccount token
# Required for Kubernetes API access to watch/update Services
# =============================================================================
apiVersion: kyverno.io/v2
kind: PolicyException
metadata:
  name: kube-vip-cloud-provider
  namespace: kube-system
  annotations:
    argocd.argoproj.io/sync-wave: "-5"
spec:
  exceptions:
    - policyName: disable-automount-sa-token
      ruleNames:
        - disable-automount-sa-token
        - autogen-disable-automount-sa-token
        - autogen-cronjob-disable-automount-sa-token
  match:
    any:
      - resources:
          kinds:
            - Deployment
            - Pod
          namespaces:
            - kube-system
          names:
            - kube-vip-cloud-provider*
